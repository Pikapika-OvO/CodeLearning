import{_ as a}from"./plugin-vue_export-helper.21dcd24c.js";import{o as i,c as r,a as n,b as e,d as o,F as c,f as s,r as p}from"./app.48f4314c.js";const l={},d=s(`<h1 id="synchronized-\u539F\u7406\u5256\u6790" tabindex="-1"><a class="header-anchor" href="#synchronized-\u539F\u7406\u5256\u6790" aria-hidden="true">#</a> Synchronized \u539F\u7406\u5256\u6790</h1><h2 id="synchronized-\u7684\u4F7F\u7528\u573A\u666F" tabindex="-1"><a class="header-anchor" href="#synchronized-\u7684\u4F7F\u7528\u573A\u666F" aria-hidden="true">#</a> synchronized \u7684\u4F7F\u7528\u573A\u666F</h2><ul><li>\u65B9\u6CD5 <ul><li>\u9759\u6001\u65B9\u6CD5\uFF1A<code>public static synchronized void doSth() { ... }</code></li><li>\u5B9E\u4F8B\u65B9\u6CD5\uFF1A<code>public synchronized void doSth() { ... };</code></li></ul></li><li>\u4EE3\u7801\u5757 <ul><li>\u5B9E\u4F8B\u5BF9\u8C61\uFF1A<code>synchronized(this) { ... };</code></li><li>class \u5BF9\u8C61\uFF1A<code>synchronized(Object.class) { ... };</code></li></ul></li></ul><h2 id="\u7B2C\u4E00\u5C42-synchronized\u4F7F\u7528" tabindex="-1"><a class="header-anchor" href="#\u7B2C\u4E00\u5C42-synchronized\u4F7F\u7528" aria-hidden="true">#</a> \u7B2C\u4E00\u5C42\uFF0Csynchronized\u4F7F\u7528</h2><h3 id="synchronized-\u4FEE\u9970\u65B9\u6CD5" tabindex="-1"><a class="header-anchor" href="#synchronized-\u4FEE\u9970\u65B9\u6CD5" aria-hidden="true">#</a> synchronized \u4FEE\u9970\u65B9\u6CD5</h3><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">doSth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;test synchronized method&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u6211\u4EEC\u5C06\u8FD9\u6BB5\u4EE3\u7801\u53CD\u7F16\u8BD1\uFF0C\u53EF\u5F97\u5230\uFF1A</p><p><mark>// todo \u622A\u56FE</mark></p><p>\u4ECE\u56FE\u4E2D\u4EE3\u7801\u53EF\u4EE5\u770B\u51FA\u6DFB\u52A0\u4E86 synchtonized \u4FEE\u9970\u7684\u65B9\u6CD5\uFF0C\u5728 JVM \u65B9\u6CD5\u8BBF\u95EE\u6807\u8BC6\u7B26\uFF08flag\uFF09\u4E2D\u591A\u52A0\u5165\u4E86 ACC_SYNCHRONIZED \u6765\u5B9E\u73B0\u540C\u6B65\u529F\u80FD\u3002</p><h3 id="synchronized-\u4FEE\u9970\u4EE3\u7801\u5757" tabindex="-1"><a class="header-anchor" href="#synchronized-\u4FEE\u9970\u4EE3\u7801\u5757" aria-hidden="true">#</a> synchronized \u4FEE\u9970\u4EE3\u7801\u5757</h3><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SynchronizedTest</span> <span class="token punctuation">{</span>
    
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doSth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">synchronized</span><span class="token punctuation">(</span><span class="token class-name">SynchronizedTest</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;test synchronized codeBody&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>   
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u53CD\u7F16\u8BD1\uFF0C\u5982\u4E0B\uFF1A</p><p><mark>// todo \u622A\u56FE</mark></p><p>\u4ECE\u56FE\u4E2D\u4EE3\u7801\u53EF\u4EE5\u770B\u51FA\u6DFB\u52A0\u4E86 synchtonized \u4FEE\u9970\u7684\u4EE3\u7801\u5757\u513F\uFF0C\u53CD\u7F16\u8BD1\u51FA\u7684 JVM \u6307\u4EE4\u4E2D\u591A\u52A0\u5165\u4E86 <strong><code>monitorenter</code></strong> \u548C <strong><code>monitorexit</code></strong> \u4E24\u884C\u6307\u4EE4\u3002\u5373 JVM \u901A\u8FC7\u8FD9\u4E2A\u4E24\u4E2A\u65B0\u52A0\u5165\u7684\u6307\u4EE4\u6765\u5B9E\u73B0\u540C\u6B65\u529F\u80FD\u3002</p><p>\u90A3\u4E48\u8FD9\u4E2A\u65F6\u5019\u6709\u9753\u4ED4\u8981\u95EE\u4E86\uFF1A<strong><code>monitorenter</code></strong> \u3001 <strong><code>monitorexit</code></strong> \u8FD9\u4E2A\u4E24\u4E2A\u6307\u4EE4\u4EE5\u53CA <strong><code>ACC_SYNCHRONIZED</code></strong> \u8BBF\u95EE\u6807\u8BC6\u7B26\uFF0C\u662F\u5982\u4F55\u8BA9\u4FDD\u8BC1\u540C\u6B65\u7684\u5462\uFF1F\u6211\u4EEC\u63A5\u7740\u5F00\u542F\u7B2C\u4E8C\u5C42\u7684\u63A2\u7D22\u3002</p><h2 id="\u7B2C\u4E8C\u5C42-jvm-\u6307\u4EE4-monitorenter\u3001monitorexit\u3001acc-synchronized" tabindex="-1"><a class="header-anchor" href="#\u7B2C\u4E8C\u5C42-jvm-\u6307\u4EE4-monitorenter\u3001monitorexit\u3001acc-synchronized" aria-hidden="true">#</a> \u7B2C\u4E8C\u5C42\uFF0CJVM \u6307\u4EE4<sub>\uFF08monitorenter\u3001monitorexit\u3001ACC_SYNCHRONIZED\uFF09</sub></h2><h3 id="monitorenter" tabindex="-1"><a class="header-anchor" href="#monitorenter" aria-hidden="true">#</a> monitorenter</h3>`,17),h={href:"https://link.juejin.cn/?target=https%3A%2F%2Fdocs.oracle.com%2Fjavase%2Fspecs%2Fjvms%2Fse8%2Fhtml%2Fjvms-6.html%23jvms-6.5.monitorenter",target:"_blank",rel:"noopener noreferrer"},m=s('<blockquote><h4 id="description" tabindex="-1"><a class="header-anchor" href="#description" aria-hidden="true">#</a> Description</h4><p>The <em>objectref</em> must be of type <code>reference</code>.</p><p>Each object is associated with a monitor. A monitor is locked if and only if it has an owner. The thread that executes <em>monitorenter</em> attempts to gain ownership of the monitor associated with <em>objectref</em>, as follows:</p><ul><li>If the entry count of the monitor associated with <em>objectref</em> is zero, the thread enters the monitor and sets its entry count to one. The thread is then the owner of the monitor.</li><li>If the thread already owns the monitor associated with <em>objectref</em>, it reenters the monitor, incrementing its entry count.</li><li>If another thread already owns the monitor associated with <em>objectref</em>, the thread blocks until the monitor&#39;s entry count is zero, then tries again to gain ownership.</li></ul></blockquote><p>emmmmmmm... \u6211\u8FD8\u662F\u8C37\u6B4C\u5427\uFF1A</p><blockquote><p>\u6BCF\u4E2A\u5BF9\u8C61\u90FD\u4E0E\u4E00\u4E2A\u76D1\u89C6\u5668\uFF08<strong>monitor \u5BF9\u8C61</strong>\uFF09\u76F8\u5173\u8054\u3002\u5F53\u4E14\u4EC5\u5F53 monitor \u5177\u6709\u6240\u6709\u8005\uFF08\u88AB\u67D0\u6761\u7EBF\u7A0B\u62E5\u6709\uFF09\u65F6\uFF0Cmonitor \u624D\u4F1A\u88AB\u9501\u5B9A\u3002\u6267\u884C monitorenter \u7684\u7EBF\u7A0B\uFF0C\u4F1A\u5C1D\u8BD5\u83B7\u5F97\u4E0E objectref\uFF08\u5BF9\u8C61\u5F15\u7528\uFF0C\u8FD9\u91CC\u4E5F\u5C31\u662F monitor \u7684\u5F15\u7528\uFF09 \u5173\u8054\u7684 monitor \u7684\u6240\u6709\u6743\uFF0C\u5982\u4E0B\u6240\u793A\uFF1A</p><p>\u5982\u679C\u4E0E objectref \u5173\u8054\u7684\u76D1\u89C6\u5668\u7684\u6761\u76EE\u8BA1\u6570\u4E3A 0\uFF0C\u5219\u7EBF\u7A0B\u8FDB\u5165\u76D1\u89C6\u5668\u5E76\u5C06\u5176\u6761\u76EE\u8BA1\u6570\u8BBE\u7F6E\u4E3A 1\u3002</p><p>\u5982\u679C\u7EBF\u7A0B\u5DF2\u7ECF\u62E5\u6709\u4E0E objectref \u5173\u8054\u7684\u76D1\u89C6\u5668\uFF0C\u5B83\u4F1A\u91CD\u65B0\u8FDB\u5165\u76D1\u89C6\u5668\uFF0C\u5E76\u589E\u52A0\u5176\u6761\u76EE\u8BA1\u6570\u3002</p><p>\u5982\u679C\u53E6\u4E00\u4E2A\u7EBF\u7A0B\u5DF2\u7ECF\u62E5\u6709\u4E0E objectref \u5173\u8054\u7684\u76D1\u89C6\u5668\uFF0C\u5219\u8BE5\u7EBF\u7A0B\u5C06\u963B\u585E\uFF0C\u76F4\u5230\u76D1\u89C6\u5668\u7684\u6761\u76EE\u8BA1\u6570\u4E3A\u96F6\uFF0C\u7136\u540E\u518D\u6B21\u5C1D\u8BD5\u83B7\u5F97\u6240\u6709\u6743\u3002</p></blockquote><h3 id="monitorexit" tabindex="-1"><a class="header-anchor" href="#monitorexit" aria-hidden="true">#</a> monitorexit</h3>',4),u={href:"https://link.juejin.cn/?target=https%3A%2F%2Fdocs.oracle.com%2Fjavase%2Fspecs%2Fjvms%2Fse8%2Fhtml%2Fjvms-6.html%23jvms-6.5.monitorexit",target:"_blank",rel:"noopener noreferrer"},k=s('<blockquote><h4 id="description-1" tabindex="-1"><a class="header-anchor" href="#description-1" aria-hidden="true">#</a> Description</h4><p>The <em>objectref</em> must be of type <code>reference</code>.</p><p>The thread that executes <em>monitorexit</em> must be the owner of the monitor associated with the instance referenced by <em>objectref</em>.</p><p>The thread decrements the entry count of the monitor associated with <em>objectref</em>. If as a result the value of the entry count is zero, the thread exits the monitor and is no longer its owner. Other threads that are blocking to enter the monitor are allowed to attempt to do so.</p></blockquote><p>\u8BD1\u6587\uFF1A</p><blockquote><p>\u6267\u884C <em>monitorexit</em> \u7684\u7EBF\u7A0B\u5FC5\u987B\u662F\u4E0E <em>objectref</em> \u5F15\u7528\u7684\u5B9E\u4F8B\u5173\u8054\u7684\u76D1\u89C6\u5668\u7684\u6240\u6709\u8005\uFF08\u5C31\u662F monitor \u7684\u62E5\u6709\u8005\uFF09\u3002</p><p>\u7EBF\u7A0B\u6267\u884C monitorexit \u6307\u4EE4\u4F1A\u8BA9 monitor \u7684\u8BA1\u6570\u5668\u51CF 1\u3002\u5982\u679C\u7ED3\u679C\u6761\u76EE\u8BA1\u6570\u7684\u503C\u4E3A 0\uFF0C\u5219\u7EBF\u7A0B\u9000\u51FA\u76D1\u89C6\u5668\u5E76\u4E14\u4E0D\u518D\u662F\u5176\u6240\u6709\u8005\uFF08\u4E0D\u518D\u62E5\u6709 monitor\uFF09\u3002\u5176\u4ED6\u963B\u585E\u5C1D\u8BD5\u83B7\u53D6 monitor \u7684\u7EBF\u7A0B\u5C31\u5141\u8BB8\u53BB\u83B7\u53D6 monitor \u4E86\u3002</p></blockquote><h3 id="acc-synchronized" tabindex="-1"><a class="header-anchor" href="#acc-synchronized" aria-hidden="true">#</a> ACC_SYNCHRONIZED</h3>',4),b={href:"https://link.juejin.cn/?target=https%3A%2F%2Fdocs.oracle.com%2Fjavase%2Fspecs%2Fjvms%2Fse8%2Fhtml%2Fjvms-2.html%23jvms-2.11.10",target:"_blank",rel:"noopener noreferrer"},v={href:"https://docs.oracle.com/javase/specs/jvms/se8/html/jvms-2.html#jvms-2.11.8",target:"_blank",rel:"noopener noreferrer"},_=n("code",null,"synchronized",-1),g=n("code",null,"method_info",-1),f={href:"https://docs.oracle.com/javase/specs/jvms/se8/html/jvms-4.html#jvms-4.6",target:"_blank",rel:"noopener noreferrer"},y=n("code",null,"ACC_SYNCHRONIZED",-1),j=n("code",null,"ACC_SYNCHRONIZED",-1),x=n("code",null,"synchronized",-1),w=n("code",null,"synchronized",-1),z=n("code",null,"synchronized",-1),C=s(`<blockquote><p>\u65B9\u6CD5\u7EA7\u540C\u6B65\u662F\u9690\u5F0F\u6267\u884C\uFF08\u7528\u6237\u611F\u77E5\u4E0D\u5230\uFF09\u7684\uFF0C\u4F5C\u4E3A\u65B9\u6CD5\u8C03\u7528\u548C\u8FD4\u56DE\u7684\u4E00\u90E8\u5206\u3002</p><p>\u540C\u6B65\u65B9\u6CD5\u5728\u8FD0\u884C\u65F6\u5E38\u91CF\u6C60\u7684 method_info \u7ED3\u6784\u4E2D\u901A\u8FC7 ACC_SYNCHRONIZED \u6807\u5FD7\u8FDB\u884C\u533A\u5206\uFF0C\u8BE5\u6807\u5FD7\u7531\u65B9\u6CD5\u8C03\u7528\u6307\u4EE4\u68C0\u67E5\u3002</p><p>\u5F53\u8C03\u7528\u8BBE\u7F6E\u4E86 ACC_SYNCHRONIZED \u7684\u65B9\u6CD5\u65F6\uFF0C\u6267\u884C\u7EBF\u7A0B\u8FDB\u5165\u76D1\u89C6\u5668\uFF0C\u8C03\u7528\u65B9\u6CD5\u672C\u8EAB\uFF0C\u7136\u540E\u9000\u51FA\u76D1\u89C6\u5668\uFF0C\u65E0\u8BBA\u65B9\u6CD5\u8C03\u7528\u662F\u6B63\u5E38\u5B8C\u6210\u8FD8\u662F\u7A81\u7136\u5B8C\u6210\u3002</p><p>\u5728\u6267\u884C\u7EBF\u7A0B\u62E5\u6709\u76D1\u89C6\u5668\u671F\u95F4\uFF0C\u6CA1\u6709\u5176\u4ED6\u7EBF\u7A0B\u53EF\u4EE5\u8FDB\u5165\u5B83\u3002</p><p>\u5982\u679C\u5728\u8C03\u7528 synchronized \u65B9\u6CD5\u65F6\u629B\u51FA\u5F02\u5E38\uFF0C\u5E76\u4E14 synchronized \u65B9\u6CD5\u6CA1\u6709\u5904\u7406\u8BE5\u5F02\u5E38\uFF0C\u5219\u5728 synchronized \u65B9\u6CD5\u91CD\u65B0\u629B\u51FA\u5F02\u5E38\u4E4B\u524D\u81EA\u52A8\u9000\u51FA\u8BE5\u65B9\u6CD5\u7684\u76D1\u89C6\u5668\u3002</p></blockquote><h3 id="synchronized-\u7B2C\u4E8C\u5C42\u5C0F\u7ED3" tabindex="-1"><a class="header-anchor" href="#synchronized-\u7B2C\u4E8C\u5C42\u5C0F\u7ED3" aria-hidden="true">#</a> synchronized \u7B2C\u4E8C\u5C42\u5C0F\u7ED3</h3><ol><li>\u540C\u6B65\u4EE3\u7801\u5757\u662F\u901A\u8FC7\u6267\u884C monitorenter \u548C monitorexit \u6307\u4EE4\u6765\u5B9E\u73B0\u7684\u3002\u5F53\u7EBF\u7A0B\u6267\u884C\u5230 monitorenter \u65F6\u8981\u83B7\u53D6 monitor \u9501\uFF0C\u624D\u80FD\u6267\u884C\u4E0B\u9762\u7684\u4EE3\u7801\u3002\u5F53\u7EBF\u7A0B\u6267\u884C\u5230 monitorexit \u65F6\u8981\u91CA\u653E monitor \u9501\u3002</li><li>\u540C\u6B65\u65B9\u6CD5\u65F6\u901A\u8FC7 JVM \u65B9\u6CD5\u8BBF\u95EE\u6807\u8BC6\u7B26 ACC_SYNCHRONIZED \u6765\u5B9E\u73B0\u7684\u3002\u5F53\u7EBF\u7A0B\u8C03\u7528\u5E26\u6709 ACC_SYNCHRONIZED \u6807\u8BC6\u7B26\u7684\u65B9\u6CD5\u65F6\u83B7\u53D6 monitor \u9501\uFF0C\u65B9\u6CD5\u6267\u884C\u5B8C\u540E\u91CA\u653E\u9501\u3002</li><li>\u4E0D\u8BBA\u662F\u540C\u6B65\u4EE3\u7801\u5757\uFF0C\u8FD8\u662F\u540C\u6B65\u65B9\u6CD5\uFF0C\u540C\u6B65\u90FD\u662F\u901A\u8FC7 monitor \u6765\u5B9E\u73B0\u7684\u3002</li><li>\u6BCF\u4E2A\u5BF9\u8C61\u90FD\u4E0E\u4E00\u4E2A monitor \u76F8\u5173\u8054\uFF0C\u7EBF\u7A0B\u53EF\u4EE5\u62E5\u6709\u6216\u8005\u91CA\u653E monitor\u3002</li><li>\u6BCF\u4E2A\u5BF9\u8C61\u90FD\u7EF4\u62A4\u6709\u4E00\u4E2A\u9501\u8BA1\u6570\u5668\uFF0C\u8BA1\u6570\u5668\u4E3A 0 \u65F6\u8868\u793A\u53EF\u4EE5\u88AB\u4EFB\u610F\u7EBF\u7A0B\u83B7\u53D6\uFF0C\u53CD\u4E4B\u4E0D\u4E3A 0 \u65F6\uFF0C\u53EA\u6709\u5F53\u524D\u83B7\u5F97\u9501\u7684\u7EBF\u7A0B\u624D\u80FD\u518D\u6B21\u83B7\u5F97\u9501\uFF0C\u5176\u4ED6\u7EBF\u7A0B\u5C06\u4F1A\u963B\u585E\u7B49\u5F85\u9501\u7684\u91CA\u653E\u3002</li></ol><p>OK\uFF0C\u5230\u8FD9\u91CC\u6211\u4EEC\u77E5\u9053\u4E86\u540C\u6B65\u65B9\u6CD5\u548C\u540C\u6B65\u4EE3\u7801\u5757\u7684\u57FA\u672C\u5B9E\u73B0\u539F\u7406\u3002\u8FD9\u4E2A\u65F6\u5019\u53C8\u6709\u9753\u4ED4\u8981\u95EE\u4E86\uFF1A\u4E0A\u9762\u6211\u4EEC\u53CD\u590D\u63D0\u5230 monitor\uFF0C\u90A3\u4E48\uFF1A</p><ul><li><p><strong>monitor \u5230\u5E95\u662F\u4EC0\u4E48\u4E1C\u897F\u5462\uFF1F</strong></p></li><li><p><strong>\u4E3A\u4EC0\u4E48\u5B83\u53EF\u4EE5\u5B9E\u73B0\u540C\u6B65\uFF1F</strong></p></li><li><p><strong>\u5BF9\u8C61\u548C monitor \u4E4B\u95F4\u662F\u600E\u6837\u5173\u8054\u7684\uFF1F</strong></p></li></ul><p>\u5E26\u7740\u8FD9\u4E9B\u95EE\u9898\u6211\u4EEC\u7EE7\u7EED</p><h2 id="\u7B2C\u4E09\u5C42-monitor-\u76D1\u89C6\u5668" tabindex="-1"><a class="header-anchor" href="#\u7B2C\u4E09\u5C42-monitor-\u76D1\u89C6\u5668" aria-hidden="true">#</a> \u7B2C\u4E09\u5C42\uFF0Cmonitor \u76D1\u89C6\u5668</h2><h3 id="\u64CD\u4F5C\u7CFB\u7EDF\u7BA1\u7A0B" tabindex="-1"><a class="header-anchor" href="#\u64CD\u4F5C\u7CFB\u7EDF\u7BA1\u7A0B" aria-hidden="true">#</a> \u64CD\u4F5C\u7CFB\u7EDF\u7BA1\u7A0B</h3><p>\u7BA1\u7A0B (\u82F1\u8BED\uFF1AMonitors\uFF0C\u4E5F\u79F0\u4E3A\u76D1\u89C6\u5668) \u662F\u4E00\u79CD\u7A0B\u5E8F\u7ED3\u6784\uFF0C\u7ED3\u6784\u5185\u7684\u591A\u4E2A\u5B50\u7A0B\u5E8F\uFF08\u5BF9\u8C61\u6216\u6A21\u5757\uFF09\u5F62\u6210\u7684\u591A\u4E2A\u5DE5\u4F5C\u7EBF\u7A0B\u4E92\u65A5\u8BBF\u95EE\u5171\u4EAB\u8D44\u6E90\u3002</p><p>\u7B80\u5355\u5730\u8BF4\u7BA1\u7A0B\u5C31\u662F\u4E00\u4E2A\u6982\u5FF5\uFF0C\u4EFB\u4F55\u8BED\u8A00\u90FD\u53EF\u4EE5\u5B9E\u73B0\u3002\u76EE\u7684\u5C31\u662F\u4E3A\u4E86\u7B80\u5316\u540C\u6B65\u8C03\u7528\u7684\u8FC7\u7A0B\u3002</p><h3 id="objectmonitor" tabindex="-1"><a class="header-anchor" href="#objectmonitor" aria-hidden="true">#</a> ObjectMonitor</h3><p>JVM \u4E2D\u7684\u540C\u6B65\u5C31\u662F\u57FA\u4E8E\u8FDB\u5165\u548C\u9000\u51FA\u7BA1\u7A0B\uFF08Monitor\uFF09\u5BF9\u8C61\u5B9E\u73B0\u7684\u3002\u6BCF\u4E2A\u5BF9\u8C61\u5B9E\u4F8B\u90FD\u4F1A\u6709\u4E00\u4E2A Monitor\uFF0CMonitor \u53EF\u4EE5\u548C\u5BF9\u8C61\u4E00\u8D77\u521B\u5EFA\u3001\u9500\u6BC1\u3002</p><h4 id="objectmonitor-\u6570\u636E\u7ED3\u6784" tabindex="-1"><a class="header-anchor" href="#objectmonitor-\u6570\u636E\u7ED3\u6784" aria-hidden="true">#</a> ObjectMonitor \u6570\u636E\u7ED3\u6784</h4><p>\u5728 Java \u4E2D Monitor \u662F\u7531 ObjectMonitor \u5B9E\u73B0\uFF0C\u800C ObjectMonitor \u662F\u7531\uFF08JVM \u6E90\u7801\u4E2D C++\uFF09 \u7684 ObjectMonitor.hpp \u6587\u4EF6\u5B9E\u73B0\u3002\u6211\u4EEC\u53EF\u4EE5\u770B\u4F5C\u5B83\u662F\u5BF9\u4E92\u65A5\u91CF\u548C\u4FE1\u53F7\u91CF\u7684\u5C01\u88C5\u5373\u53EF\u3002\u5982\u4E0B\u6240\u793A\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">ObjectMonitor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	_header       <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
    _count        <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> 		
    _waiters      <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>
    _recursions   <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    _object       <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
    _owner        <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>	
    _WaitSet      <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>	
    _WaitSetLock  <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">;</span>
    _Responsible  <span class="token operator">=</span> <span class="token constant">NULL</span> <span class="token punctuation">;</span>
    _succ         <span class="token operator">=</span> <span class="token constant">NULL</span> <span class="token punctuation">;</span>
    _cxq          <span class="token operator">=</span> <span class="token constant">NULL</span> <span class="token punctuation">;</span>
    <span class="token class-name">FreeNext</span>      <span class="token operator">=</span> <span class="token constant">NULL</span> <span class="token punctuation">;</span>
    _EntryList    <span class="token operator">=</span> <span class="token constant">NULL</span> <span class="token punctuation">;</span>	
    _SpinFreq     <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">;</span>
    _SpinClock    <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">;</span>
    <span class="token class-name">OwnerIsThread</span> <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u51E0\u4E2A\u6BD4\u8F83\u91CD\u8981\u7684\u5C5E\u6027\uFF1A</p><ul><li><code>_count</code>\uFF1A\u8BB0\u5F55 owner \u7EBF\u7A0B\u83B7\u53D6\u9501\u7684\u6B21\u6570\uFF0C\u8FD9\u53E5\u8BDD\u5F88\u597D\u7406\u89E3\uFF0C\u8FD9\u4E5F\u51B3\u5B9A\u4E86 synchronized \u662F<strong>\u53EF\u91CD\u5165</strong>\u7684\u3002</li><li><code>_owner</code>\uFF1A\u6307\u5411\u62E5\u6709\u8BE5\u5BF9\u8C61\u7684\u7EBF\u7A0B\u3002</li><li><code>_recursions</code>\uFF1A\u9501\u7684\u91CD\u5165\u6B21\u6570\u3002</li><li><code>_WaitSet</code>\uFF1A\u5904\u4E8E <strong>wait</strong> \u72B6\u6001\u7684\u7EBF\u7A0B\uFF0C\u4F1A\u88AB\u52A0\u5165\u5230 <code>_WaitSet</code> \u961F\u5217\u3002</li><li><code>_EntryList</code>\uFF1A\u5904\u4E8E <strong>block\uFF08\u7B49\u5F85\u9501 \uFF09</strong> \u72B6\u6001\u7684\u7EBF\u7A0B\uFF0C\u4F1A\u88AB\u52A0\u5165\u5230 <code>_EntryList</code> \u961F\u5217\u3002</li></ul><p>\u524D\u4E09\u4E2A\u5C5E\u6027\u90FD\u6BD4\u8F83\u597D\u7406\u89E3\uFF0C\u5BF9\u4E8E\u540E\u9762\u4E24\u4E2A\u961F\u5217\u6211\u4EEC\u53EF\u4EE5\u4E3E\u4F8B\u8BF4\u660E\uFF1A</p><p><img src="https://cdn.jsdelivr.net/gh/WalterXiong/typora-img/img/202212041520075.png" alt="image-20221204152007002" loading="lazy"></p><h4 id="\u8FD0\u4F5C\u673A\u7406" tabindex="-1"><a class="header-anchor" href="#\u8FD0\u4F5C\u673A\u7406" aria-hidden="true">#</a> \u8FD0\u4F5C\u673A\u7406</h4><p><strong>Monitor \u662F\u4F9D\u9760\u5E95\u5C42\u64CD\u4F5C\u7CFB\u7EDF\u7684 Mutex Lock \u6765\u5B9E\u73B0\u4E92\u65A5\u7684\uFF0C\u7EBF\u7A0B\u7533\u8BF7 Mutex \u6210\u529F\uFF0C\u5219\u6301\u6709\u8BE5 Mutex\uFF0C\u5176\u5B83\u7EBF\u7A0B\u5C06\u65E0\u6CD5\u83B7\u53D6\u5230\u8BE5 Mutex\u3002</strong></p><p>\u5982\u56FE\uFF1A</p><p><img src="https://cdn.jsdelivr.net/gh/WalterXiong/typora-img/img/202212041616952.png" alt="image-20221204161649889" loading="lazy"></p><ol><li>\u60F3\u8981\u83B7\u53D6 monitor \u7684\u7EBF\u7A0B\u8FDB\u5165 monitor \u7684 _EntryList \u961F\u5217\uFF08\u5373\u9047\u5230\u540C\u6B65\u5173\u952E\u7EC4\u5B57\u65F6\uFF09\u963B\u585E\u7B49\u5F85\u3002</li><li>\u5F53 monitor \u7684 _owner \u4E3A\u7A7A\u8868\u793A\u7EBF\u7A0B\u53EF\u4EE5\u83B7\u53D6\u8BE5 monitor \u5BF9\u8C61\uFF0C\u5219\u4ECE _EntryList \u961F\u5217\u4E2D\u5C06\u5176\u79FB\u51FA\uFF0C\u5E76\u5C06\u5176\u8D4B\u503C\u7ED9 monitor \u7684 _owner \u5C5E\u6027\uFF0C\u540C\u65F6\u5BF9\u8C61\u7684\u9501\u8BA1\u6570\u5668 +1\u3002<mark>\uFF08\u8FDB\u5165\u4E0A\u56FE\u7684 _Owner \u533A\u57DF\uFF0C\u8FD9\u65F6\u5019\u7EBF\u7A0B\u5F00\u59CB\u6267\u884C\u540C\u6B65\u533A\u4E2D\u7684\u4EE3\u7801\uFF09</mark></li><li>\u5982\u679C\u7EBF\u7A0B\u5728\u6267\u884C\u671F\u95F4\u8C03\u7528\u4E86 wait() \u65B9\u6CD5\uFF0C\u5219\u7EBF\u7A0B\u4F1A\u8FDB\u5165 _WaitSet \u961F\u5217\u3002\u7EBF\u7A0B\u8C03\u7528 wait() \u65B9\u6CD5\u4F1A\u91CA\u653E monitor \u9501\uFF0C\u5373\u5C06 monitor \u7684 _owner \u5C5E\u6027\u8D4B\u503C\u4E3A null\uFF0C\u540C\u65F6\u9501\u8BA1\u6570\u5668 -1\uFF0C\u8FDB\u5165 _WaitSet \u961F\u5217\u963B\u585E\u7B49\u5F85\u3002\u6B64\u65F6\u5176\u4ED6\u4F4D\u4E8E _EntryList \u961F\u5217\u4E2D\u7684\u7EBF\u7A0B\u5C31\u53EF\u4EE5\u83B7\u53D6\u9501\u4E86\u3002</li><li>\u5982\u679C\u7A0B\u5E8F\u4E2D\u7684\u5176\u4ED6\u7EBF\u7A0B\u8C03\u7528 notify() / notifyAll() \u65B9\u6CD5 \uFF0C\u4F1A\u5524\u9192 _WaitSet \u961F\u5217\u4E2D\u7684\u67D0\u4E2A\u7EBF\u7A0B\uFF0C\u8BE5\u7EBF\u7A0B\u518D\u6B21\u5C1D\u8BD5\u83B7\u53D6 monitor \u9501\uFF0C\u6210\u529F\u5373\u8FDB\u5165 _Owner\u533A\u57DF\uFF0C\u5373\u6210\u4E3A monitor \u7684 _owner \u5C5E\u6027\u3002</li><li>\u540C\u6B65\u65B9\u6CD5\u6267\u884C\u5B8C\u6BD5\uFF0C\u7EBF\u7A0B\u9000\u51FA\u4E34\u754C\u533A\uFF0C\u4F1A\u5C06 monitor \u7684 _owner \u8D4B\u503C\u4E3A null\uFF0C\u5E76\u91CA\u653E\u76D1\u89C6\u9501\uFF08monitor \uFF09\u3002</li></ol><p>\u6211\u4EEC\u53EF\u4EE5\u77E5\u9053\u5176\u5B9E\u4E0A\u8FF0\u7684\u64CD\u4F5C\u90FD\u5BF9\u5E94\u4E86 ObjectMonitor \u7684\u65B9\u6CD5\u3002\u5373 wait/notify/notifyAll \u8FD9\u4E9B\u5E95\u5C42\u90FD\u662F\u8C03\u7528 ObjectMonitor \u7684\u65B9\u6CD5\u800C\u5DF2\uFF0C\u5982\u4E0B\uFF1A</p><p><img src="https://upload-images.jianshu.io/upload_images/8694380-c4a60ba68bcc7704.png?imageMogr2/auto-orient/strip|imageView2/2/format/webp" alt="img" loading="lazy"></p><h3 id="\u5BF9\u8C61\u4E0E-monitor-\u7684\u5173\u8054" tabindex="-1"><a class="header-anchor" href="#\u5BF9\u8C61\u4E0E-monitor-\u7684\u5173\u8054" aria-hidden="true">#</a> \u5BF9\u8C61\u4E0E monitor \u7684\u5173\u8054</h3><p><img src="https://upload-images.jianshu.io/upload_images/8694380-ac10c2a5c942c0f4.png?imageMogr2/auto-orient/strip|imageView2/2/format/webp" alt="img" loading="lazy"></p><p>\u56FE\u7247\u7ED3\u5408\u4E0A\u4E00\u7BC7 <a href="">\u7EBF\u7A0B\u540C\u6B65\u4E0E\u9501\u4F18\u5316</a> \u4E00\u8D77\u770B\u6548\u679C\u4F1A\u66F4\u597D\u3002</p>`,29);function N(S,F){const t=p("ExternalLinkIcon");return i(),r(c,null,[d,n("p",null,[e("\u6709\u5174\u8DA3\u7684\u540C\u5B66\u53EF\u4EE5\u770B\u4E0B\u5B98\u65B9\u5B9A\u4E49\uFF1A"),n("a",h,[e("monitorenter\u6307\u4EE4\u4ECB\u7ECD"),o(t)])]),m,n("p",null,[n("a",u,[e("monitorexit\u6307\u4EE4\u4ECB\u7ECD"),o(t)])]),k,n("p",null,[n("a",b,[e("ACC_SYNCHRONIZED\u4ECB\u7ECD"),o(t)])]),n("blockquote",null,[n("p",null,[e("Method-level synchronization is performed implicitly, as part of method invocation and return ("),n("a",v,[e("\xA72.11.8"),o(t)]),e("). A "),_,e(" method is distinguished in the run-time constant pool's "),g,e(" structure ("),n("a",f,[e("\xA74.6"),o(t)]),e(") by the "),y,e(" flag, which is checked by the method invocation instructions. When invoking a method for which "),j,e(" is set, the executing thread enters a monitor, invokes the method itself, and exits the monitor whether the method invocation completes normally or abruptly. During the time the executing thread owns the monitor, no other thread may enter it. If an exception is thrown during invocation of the "),x,e(" method and the "),w,e(" method does not handle the exception, the monitor for the method is automatically exited before the exception is rethrown out of the "),z,e(" method.")])]),C],64)}var O=a(l,[["render",N],["__file","\u7EBF\u7A0B\u5B89\u5168\u4E0E\u9501\u4F18\u5316 - Synchronized \u539F\u7406\u5256\u6790.html.vue"]]);export{O as default};
